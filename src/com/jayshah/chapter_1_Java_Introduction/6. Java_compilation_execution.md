# Compilation and Execution


```java

  _____________________________________________
  | Test.java                                  |
  | class Test                                 |
  | { ----  }                                  |
  |                                            |
  |    ||                                      |
  |    \/                                      |
  |                                            |
  |  compiler                                  |
  |                                            |
  |     ||                                     |
  |     \/                                     |
  |                                            |
  |   Test.class                               |
  |   byte code                                |
  |   [looks like dgkhdjkhs]                   |
  |                                            |
  |____________________________________________|
                | |     java Test
                \ /
  JVM: 
            - Class Loader
            - Memory Area (5 types)
            - Execution Engine | JNI | NML
            
                 |  |
                 |  |
                 \  /
                  \/

```
```
     ____________________________________________________________________________________
    |                                   Class Loader                                     |
    |    ____________________________________________________________________________    |
    |   |                                                                            |   |
    |   |                                                                            |   |
    |   |____________________________________________________________________________|   |
    |                             ||                    /\                               |
    |                             \/                    ||                               |
    |    ____________________________________________________________________________    |
    |   |                               Memory Area                                  |   |
    |   |     __      __      __     __    __                                        |   |
    |   |    |__|    |__|    |__|   |__|  |__|    total 5 types of the memory area   |   |
    |   |____________________________________________________________________________|   |
    |             ||          /\                                                         |
    |             \/          ||                                                         |
    |    ___________________________________        ________       _______               |
    |   |           Execution Engine        |   -> | JNI    | <-- | NML   |              |
    |   |___________________________________|   <- |________|     |_______|              |
    |____________________________________________________________________________________|

                ||
                \/
                OutPut: Hello Test.Java

    JNI: Java Native Interface  
    NML: Native Method Libraries => Programming done ib different language

```
### Interview Questions:
1. What is the role of the compiler? Or What happens in java compilation phase?
   - 1. Compiler checks the syntax it is correct or not (whether the class, methods, interface, variable declaration etc is correct or not, Java is case sensitive language thus it checks upper case and lower case keyword names)
     - example: 
         ```
       class Test {
            public static void main() {
          
            }
       }
       ```
   - 2. Java is strongly typed language thus compiler checks whether the variable has stored correct value or not
   - 3. Compiler ignores all comments.
   - 4. Compiler generates the byte code
   
2. What is the role of JVM? OR What happens in execution phase?
    - 1. Byte code is loaded in JVM
    - 2. Byte code verifier checks whether the byte code is correct or not
    - 3. Memory allocation starts (variables, methods, class information etc)
    - 4. Interpreter and JIT compiler execute our program and provides the output. 


**Note:** Compilation work done by `compiler` &&  Execution work done by `JVM`

3. What is virtual Machine?
   - It is a software simulation (copy) of a machine which performs operation similar to physics machine e.g. calculator or JVM. 
   - Types of Virtual Machine:
     - 1. Hardware based VM or System based VM
     - 2. Application based pr Process based VM
   - JVM is Application based Virtual Based Machine


4. What is JVM (Java Virtual Machine)?
   - JVM is Java Virtual Machine which is used to execute java byte coded 
   - JVM is Application based or Process based VM
   - Role of JVM (refer Question no. 2)
   - Architecture of JVM


5. Explain deep architecture of class loader



### JDK Architecture
```
                    
     _____________________________________________________________________________________
    |                            JDK : Java Development Kit                               |
    |_____________________________________________________________________________________|
    |    __________________________________________________   _________________________   |       
    |   |   JRE : Java Runtime Environment                 | |  Development Tools      |  |
    |   |__________________________________________________| |_________________________|  |  
    |   |   _____________________________    __________    | |                         |  |
    |   |  |            JVM              |  |  Java    |   | |     - java              |  |
    |   |  |_____________________________|  |  Package |   | |     - javac             |  |
    |   |  |    - class loader           |  |  Classes |   | |     - javadocs          |  |
    |   |  |    - Memory areas           |  |__________|   | |     - javaw             |  |
    |   |  |    - Execution Engine       |  ___________    | |                         |  |
    |   |  |_____________________________| | Runtime   |   | |                         |  |
    |   |                                  | Libraries |   | |                         |  | 
    |   |                                  |___________|   | |                         |  |
    |   |__________________________________________________| |_________________________|  |
    |                                                                                     |
    |_____________________________________________________________________________________|
 
```




### JDK (Java Development Kit)

- Java Development Kit contains tools needed to develop the Java programs, and JRE to run the programs. The tools include compiler (javac.exe), Java application launcher (java.exe), Appletviewer, etc
- JDK is mainly targeted for java development. i.e. You can create a Java file (with the help of Java packages), compile a Java file and run a java file.
- ### `JDK = JRE + Development Tools`

### JRE (Java Runtime Environment)
- Java Runtime Environment contains JVM, class libraries, and other supporting files. It does not contain any development tools such as compiler, debugger, etc.
- Actually JVM runs the program, and it uses the class libraries, and other supporting files provided in JRE. 
- Means when JVM runs the program that time pre-define classes, libraries, etc are provided by JRE from Java Package Classes and Runtime Libraries
If you want to run any java program, you need to have JRE installed in the system
- ### `JRE = JVM + Java Package Classes + Runtime Libraries`


### JVM (Java Virtual Machine)
- JVM is an abstract machine. It is a specification that provides runtime environment in which java bytecode can be executed.
- JVM's are available for many hardware and software platforms. JVM is platform dependent because configuration of each OS differs and this makes java Platform Independent.
- JVM performs following main tasks:
  - Loads code
  - Verifies code
  - Executes code
  - Provides runtime environment Libraries


### Class Loader Architecture 
```
    ___________________________________________________________________________________________
    |                                   Class Loader                                            |
    |___________________________________________________________________________________________|
    |                                                                                           |
    |              Loading                     Linking                    Initialsation         |
    |    ____________________________       _______________       __________________________    |
    |   |                            |     |  - verify     |     | - all static variables   |   |
    |   | - Boostrap Class Loader    |     |       |       |     |   are assigned with      |   |
    |   | - Extension Class Loader   |     |      \/       |     |   original values        |   |
    |   | - Application Class Loader | --> |  - Prepare    | --> |                          |   |
    |   |                            |     |       |       |     | - static blocks will be  |   |
    |   |____________________________|     |      \/       |     |   executed from top to   |   |
    |                                      |  - Resolve    |     |   bottom                 |   |
    |                                      |_______________|     |__________________________|   |
    |___________________________________________________________________________________________|

    Class Loader : It is responsible for the following tasks       
                  1. Loading
                  2. Linking
                  3. Initilizing

```

Class Loader : It is responsible for the following tasks       
1. Loading :  
   - read byte code(.class file) and related all information store in method area i.e. fully class information, its parents class info - methods, variables, constructors, constants, modifiers 
       - Bootstrap Class Loader: read from rt.jar file. `c://programfileas/java/jdk/jre/lib/rt.jar`
       - Extension Class Loader: read from extension class path `c://programfileas/java/jdk/jre/lib/ext/`
       - Application Class Loader: load from application class path
2. Linking 
    - a. Verify: 
      - byte code verify work in this. To check .class file whether it is proper or not.
      - That file generated by proper compiler or not, etc.
      - if getting any violation then throw an exception `java.lang.verifyError`
    - b. Prepare:
      -  allocate memory to class level variable e.g. static value - allocate memory and initialize(give) default value (int = 0, String = null).
    - c. Resolve:
      - symbolic names will be replaced by original memory references. 
3. Initializing
   - all static variables which have default values initialized, those values will be replaced by original values. 
   - All static blocks will be executed from `TOP to BOTTOM.` 



### Memory Areas

```

     ______________         ______________        
    |               |      |              |
    |  Method Area  |      |   Heap Area  |
    |_______________|      |______________|
    
     ____________________      ______________
    |  | t1 |  | t2 |    |    |   _____      |
    |  |    |  |    |    |    |  |_____| t1  |
    |  |----|  |----| .. |    |   _____      |
    |  |____|  |____|    |    |  |_____| t2  |
    |____________________|    |   _____      |
        Stack Area            |  |_____| tn  |
                              |______________|
                                  PC Register
     ____________________     
    |  | t1 |  | t2 |    |    
    |  |    |  |    |    |    
    |  |----|  |----| .. |    
    |  |____|  |____|    |    
    |____________________|    
       Native Method Area           
                                  
```


#### **Method Area:**

- _**store information of .class file**_
- _**store static variables**_
- when JVM starts that time this area creates
- For one JVM only one method area creates
- Because of above reason, multiple threads can access this area and due to this reason, this is not thread safe

#### **Heap Area:**

- _**store objects, arrays, instant variables**_
- when JVM starts that time this area creates
- For one JVM only one method area creates
- Because of above reason, multiple threads can access this area and due to this reason, this is not thread safe

#### **Stack Area:**

- _**store current running methods, local variables**_
- When new thread creates that time it creates its own static area and once thread terminates that time this stack area will be also deleted.
- This is thread safe.


#### **PC Register Area:**

- _**store address of the next executive instance**_
- Each and every thread has its own PC Register area that's way it is thread safe.

#### **Native Method Area:**

- _**store native methods which are going to use in our program**_
- This is thread safe.

### Interview Questions
1. What data is stored in Memory area?
2. What data is stored in Heap area?
3. What data is stored in Stack are?
4. Where local variables are stored?
5. Where instance variables are stored?
6. Where static variables are stored?
7. Which memory area are thread safe? why?
8. How many memory areas are present in JVM? 
    - Total 5 types of memory areas

### Execution Engine

```
                ___________________________________________________________________________________    
               |              |          JIT Compiler                               |              |
               |              |    _____________________________                    |              |
               |              |   | Intermediate Code Generator |                   |              |
               |              |   |_____________________________|                   |              |
               | Interpreter  |              |                                      |              |
               |              |             \/                                      |    Garbage   |
               |              |    _____________________________                    |   Collector  |
               |              |   |       Code Optimizer        |                   |              |
               |              |   |_____________________________|                   |              |
               |              |               |                                     |              |
               |              |              \/                                     |   Security   |
               |              |     _____________________________                   |    Manager   |
               |              |    |    Target Code Generator    |                  |              |
               |              |    |_____________________________|                  |              |
               |              |               |                        __________   |              |
               |              |              \/                       | Profiler |  |              |
               |              |      _____________________________    |  for     |  |              |
               |              |     | Machine Code / Native Code  |   | hotspot  |  |              |
               |              |     |_____________________________|   |__________|  |              |
               |______________|_____________________________________________________|______________|     


                          Execution Engine (Central Component of JVM)

```

- **Interpreter:** interpret byte code into machine code/native code
- **JIT compiler:** Those method are called and run many times, those method values stores into threshold value; after those methods' values are increased more than the threshold values (excess - more); than it interprets those values and store with him. Next whenever it needs just give those values directly and do not convert byte code to machine code again and again for those methods. (So that, your program speed can be fast).
- Garbage Collector: delete waste objects from the memory.
- Security Manager: provides security


### Interview Questions
1. Explain the working of Execution Engine
2. What is the JIT compiler

### JNI - Java Native Interface
- it is working as mediator between Execution engine and Native Method Libraries. 

### Native Method Libraries
- When methods written in other language known as Native Method. For use of these methods, you need JNI. 